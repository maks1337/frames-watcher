var FrameWatcher;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=0,this.height=0,this.iframe=!1,this.setSize(t,e),this.setMetadata()}return t.prototype.setMetadata=function(){this.iframe=window.location!=window.parent.location,this.url=window.location.href,this.domain=window.location.hostname},t.prototype.getSize=function(){return{width:this.width,height:this.height}},t.prototype.setSize=function(t,e){t>0&&e>0?(this.width=t,this.height=e):(this.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)},t}();t.Context=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(t,e){this.viewed={},this._timeline=[];var i=document.getElementById(t);if(!(i instanceof Object))throw new Error("Invalid hook id");this.element=this.getHookParent(i),this.id=this.element.id,this.code=e}return t.prototype.getHookParent=function(t){return t.parentElement},t.prototype.getTimeline=function(){return this._timeline},t.prototype.addToTimeline=function(t){t>0&&this._timeline.push(t)},t.prototype.getSize=function(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}},t.prototype.getRects=function(){if(!(this.element instanceof Object))throw new Error("FrameElement element in not a proper object");if("getClientRects"in this.element)return this.rects=this.element.getClientRects()[0],this.rects;throw new Error("FrameElement can't get element rects")},t}();t.Element=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(t,e){this.element=t,this.context=e,this.runCalculation()}return t.prototype.runCalculation=function(){return this.calculate(this.element.getSize(),this.element.getRects(),this.context.getSize())},t.prototype.calculate=function(t,e,i){var n=0,r=t.height,o=t.width,h=t.height*t.width;e.top<0&&(r=t.height+e.top,r<0&&(r=0),r>t.height&&(r=t.height)),i.width<e.right&&(o=i.width-e.left,o<0&&(o=0),o>t.width&&(o=t.width)),e.bottom>i.height&&(r=t.height-(e.bottom-i.height),r<0&&(r=0),r>t.height&&(r=t.height)),e.left<0&&(o=t.width+e.left,o<0&&(o=0),o>t.width&&(o=t.width));var a=o*r;return(e.bottom>0||e.top>0)&&e.top<i.height&&e.left<i.width&&(n=Math.round(a/h*Math.pow(10,2))/Math.pow(10,2)),n},t}();t.Estimation=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(){this.name="basic"}return t.prototype.validate=function(t){return t.sort()[t.length-1]>=.5},t}();t.BasicStrategy=e;var i=function(){function t(){this.name="full"}return t.prototype.validate=function(t){return 1==t.sort()[t.length-1]},t}();t.FullStrategy=i;var n=function(){function t(){this.name="long"}return t.prototype.validate=function(t){var e=t.reduce(function(t,e){return t[e]?t[e]++:t[e]=1,t},{});return e[1]?e[1]>=5:e[1]<5},t}();t.LongStrategy=n;var r=function(){function t(t){this.strategy=t,this.name=t.name}return t.prototype.run=function(t){return this.strategy.validate(t)},t}();t.StrategyCheck=r}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function e(){this._elements=[],this._debug=!1,this._intervalTickRate=1e3,this._timeLimit=6e5,this._timeElapsed=this._intervalTickRate,this._strategies=[],this.context=new t.Context,this.bindRuntime();var e=new t.StrategyCheck(new t.BasicStrategy),i=new t.StrategyCheck(new t.FullStrategy),n=new t.StrategyCheck(new t.LongStrategy);this._strategies[e.name]=e,this._strategies[i.name]=i,this._strategies[n.name]=n}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t},enumerable:!0,configurable:!0}),e.prototype.bindRuntime=function(){var t=this;window.addEventListener("resize",function(){t.context.setSize(0,0)}),this._interval=setInterval(function(){t.checkElements(),t._timeElapsed+=t._intervalTickRate,t.expireRuntime()},this._intervalTickRate)},e.prototype.expireRuntime=function(){return this._timeElapsed>=this._timeLimit&&(clearInterval(this._interval),!0)},e.prototype.checkElements=function(){this._debug===!0&&console.log("------ second: "+this._timeElapsed/1e3);for(var e=0,i=this._elements;e<i.length;e++){var n=i[e],r=new t.Estimation(n,this.context),o=r.runCalculation();n.addToTimeline(o);for(var h in this._strategies){var a=this._strategies[h];n.viewed[a.name]=a.run(n.getTimeline())}this._debug===!0&&console.log(n.id,n.code,o,n.viewed)}},e.prototype.registerElement=function(e,i){this._elements.push(new t.Element(e,i)),this.checkElements()},Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),e}();t.Runner=e}(FrameWatcher||(FrameWatcher={}));