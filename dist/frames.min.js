var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},FrameWatcher;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=0,this.height=0,this.iframe=!1,this.setSize(t,e),this.setMetadata()}return t.prototype.setMetadata=function(){this.iframe=window.location!==window.parent.location,this.url=window.location.href,this.domain=window.location.hostname},t.prototype.getSize=function(){return{width:this.width,height:this.height}},t.prototype.setSize=function(t,e){t>0&&e>0?(this.width=t,this.height=e):(this.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)},t}();t.Context=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(t,e){this.viewed=[],this._timeline=[];var n=document.getElementById(t);if(!(n instanceof Object))throw new Error("Invalid hook id");this.element=this.getHookParent(n),this.id=this.element.id,this.code=e}return t.prototype.getHookParent=function(t){return t.parentElement},t.prototype.getTimeline=function(){return this._timeline},t.prototype.addToTimeline=function(t){t>0&&this._timeline.push(t)},t.prototype.getSize=function(){return{width:this.element.offsetWidth,height:this.element.offsetHeight}},t.prototype.getRects=function(){if(!(this.element instanceof Object))throw new Error("FrameElement element in not a proper object");if("getClientRects"in this.element)return this.rects=this.element.getClientRects()[0],this.rects;throw new Error("FrameElement can't get element rects")},t}();t.Element=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(t,e){this.element=t,this.context=e,this.runCalculation()}return t.prototype.runCalculation=function(){return this.calculate(this.element.getSize(),this.element.getRects(),this.context.getSize())},t.prototype.calculate=function(t,e,n){var i=0,r=t.height,o=t.width,a=t.height*t.width;return e.top<0&&(r=t.height+e.top,r=r<0?0:r,r>t.height&&(r=t.height)),n.width<e.right&&(o=n.width-e.left,o=o<0?0:o,o>t.width&&(o=t.width)),e.bottom>n.height&&(r=t.height-(e.bottom-n.height),r=r<0?0:r,r>t.height&&(r=t.height)),e.left<0&&(o=t.width+e.left,o=o<0?0:o,o>t.width&&(o=t.width)),(e.bottom>0||e.top>0)&&e.top<n.height&&e.left<n.width&&(i=Math.round(o*r/a*Math.pow(10,2))/Math.pow(10,2)),i},t}();t.Estimation=e}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(){this.name="basic"}return t.prototype.validate=function(t){return t.sort()[t.length-1]>=.5},t}();t.BasicStrategy=e;var n=function(){function t(){this.name="full"}return t.prototype.validate=function(t){return 1===t.sort()[t.length-1]},t}();t.FullStrategy=n;var i=function(){function t(){this.name="long"}return t.prototype.validate=function(t){var e=t.reduce(function(t,e){return t[e]?t[e]++:t[e]=1,t},{});return e[1]?e[1]>=5:e[1]<5},t}();t.LongStrategy=i;var r=function(){function t(){this.name="time"}return t.prototype.validate=function(t){var e=t.reduce(function(t,e){return t[e]?t[e]++:t[e]=1,t},{});return e[1]?e[1]>=5:e[1]<5},t}();t.TimeStrategy=r;var o=function(){function t(t){this.strategy=t,this.name=t.name}return t.prototype.run=function(t){return this.strategy.validate(t)},t}();t.StrategyCheck=o}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function t(t,e,n){var i=this;this._data={code:t.code,placement:t.id,view:n?n:this.uuid()},e&&(this._data.cookie=e),t.viewed.forEach(function(t){return i._data["strat-"+t[0]]=t[1]})}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.uuid=function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);var n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&o]+t[o>>8&255]+t[o>>16&255]+t[o>>24&255]},t}();t.Data=e;var n=function(){function t(t){this.url=void 0,this._cookie=void 0,this._viewId=void 0,this.url=t}return Object.defineProperty(t.prototype,"cookie",{get:function(){return this._cookie},set:function(t){this._cookie=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewId",{get:function(){return this._viewId},set:function(t){this._viewId=t},enumerable:!0,configurable:!0}),t.prototype.loadElements=function(t){this.elements=t},t.prototype.prepareData=function(){var t=this,n=[];return this.elements.forEach(function(i){var r=new e(i,t._cookie,t._viewId);n.push(r.data)}),n},t}();t.Sender=n;var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.send=function(){this.prepareData();return!0},e}(n);t.HttpSender=i;var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.send=function(){this.prepareData();return!0},e}(n);t.SocketSender=r;var o=function(t){function e(){t.apply(this,arguments),this.headerDrawn=!1}return __extends(e,t),e.prototype.send=function(){var t=this,e=this.prepareData(),n=["placement","strat-basic"];return e.forEach(function(e){var i=[];for(var r in e)n.indexOf(r)>-1&&i.push(""+e[r]);console.log(t.url,i.join(" "))}),!0},e}(n);t.ConsoleSender=o;var a=function(){function t(t,e){if("http"===t&&(this.sender=new i(e)),"socket"===t&&(this.sender=new r(e)),"console"===t&&(this.sender=new o(e)),!this.sender.hasOwnProperty("url"))throw new Error("invalid sender requested: "+t)}return t.prototype.returnObject=function(){return this.sender},t}();t.SenderSelect=a}(FrameWatcher||(FrameWatcher={}));var FrameWatcher;!function(t){var e=function(){function e(e,n,i,r){void 0===e&&(e="http"),void 0===i&&(i=void 0),void 0===r&&(r=void 0),this._elements=[],this._debug=!1,this._intervalTickRate=1e3,this._timeLimit=6e5,this._timeElapsed=this._intervalTickRate,this._strategies=[],this.context=new t.Context,this.loadStrategies();try{var o=new t.SenderSelect(e,n);this._sender=o.returnObject(),this._sender.cookie=i,this._sender.viewId=r,this.bindRuntime()}catch(t){console.log("Runner not started because: "+t)}}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sender",{get:function(){return this._sender},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),e.prototype.sendData=function(){this._sender.loadElements(this._elements),this._sender.send()},e.prototype.loadStrategies=function(){var e=new t.StrategyCheck(new t.BasicStrategy),n=new t.StrategyCheck(new t.FullStrategy),i=new t.StrategyCheck(new t.LongStrategy),r=new t.StrategyCheck(new t.TimeStrategy);this._strategies[e.name]=e,this._strategies[n.name]=n,this._strategies[i.name]=i,this._strategies[r.name]=r},e.prototype.run=function(){try{this.checkElements(),this._timeElapsed+=this._intervalTickRate,this.expireRuntime(),this.sendData()}catch(t){console.log("runtime stopped "+t),this.expireRuntime(!0)}},e.prototype.bindRuntime=function(){var t=this;this.run(),window.addEventListener("resize",function(){t.context.setSize(0,0)}),this._interval=setInterval(function(){return t.run()},this._intervalTickRate)},e.prototype.expireRuntime=function(t){return void 0===t&&(t=!1),!!(this._timeElapsed>=this._timeLimit||t)&&(clearInterval(this._interval),!0)},e.prototype.checkElements=function(){this._debug===!0&&console.log("------ second: "+this._timeElapsed/1e3);for(var e=0,n=this._elements;e<n.length;e++){var i=n[e],r=new t.Estimation(i,this.context),o=r.runCalculation();i.addToTimeline(o),i.viewed=[];for(var a in this._strategies){var h=this._strategies[a];i.viewed.push([h.name,h.run(i.getTimeline())])}this._debug===!0&&console.log(i.id,i.code,o,i.viewed)}},e.prototype.registerElement=function(e,n){this._elements.push(new t.Element(e,n)),this.checkElements()},e}();t.Runner=e}(FrameWatcher||(FrameWatcher={}));